// room script file
import function talk(String pito,  bool change);
import function paso(int id1,  int id2);
import function endHablar();
import function interact(int x,  int y, String texto,  Character* personaje);
import function hablar(int id1,  int id2,  int x,  int y);

function room_FirstLoad()
{
  gui[2].Visible = true;
  gui[1].Visible = true;
  paso(2, 1);
  talk("¡Bienvenido a la discoteca! Estoy totalmente seguro de que tus padres se conocieron en una de estas, con un alto índice de alcohol en vena. Probablemente esa misma noche es en la que te engendraron, pero ese es otro tema.", false);
  talk("En esta discoteca ha ocurrido un asesinato, como podrás deducir por el salame que hay en el medio de la sala. Debes resolver quién es el asesino. Veamos las reglas de esta sala:", false);
  talk("-Si la música se detiene debes reanudarla con la mesa de mezclas del escenario. Dispondrás de cinco segundos.", false);
  talk("- Si las luces se apagan debes cubrirte hasta que se vuelvan a apagar.", false);
  talk("-Si el escenario tiembla debes quedarte completamente quieto.", false);
  talk("¿A qué te refieres con que me cubra? ¿Dónde me tengo que cubrir?", true);
  talk("A tu derecha hay una manta. Utilízala para taparte cuando sea necesario.", false);
  talk("¿Y si no me da tiempo a cubrirme lo suficientemente rápido?", true);
  talk("No llores tanto, sólo es darle a la E.", false);
  talk("¿Qué F?", true);
  talk("Cállate.", false);
  talk("...", true);
  talk("Vamos… examina la habitación con tus sentidos de brujo.", false);
  talk("Qué puto friki...", true);
  endHablar();
}

function hHotspot1_WalkOn()
{
  if (!dead){
    if (interact(1040, 1140, "Pues sí que está muerto… Me recuerda al funeral de mi abuelo.", cCadaver)){
    }
  }
  else if (!zoom && !guantes){
    if (interact(1040, 1140, "Lo siento, pibe, pero te voy a tener que quitar un guante. Yo lo voy a necesitar más que tú, así que no te quejes.", cCadaver)){
      cJuli.AddInventory(iGuantes);
      guant = true;
      guantes = true;
    }
  }
  else if (zoom) {
    if (interact(1040, 1140, "Ahora sólo tengo que encontrar a quién le pertenecen estas huellas.", cCadaver)){
      if (first1) {
        gui[4].Visible = true;
        first1 = false;
      }
      if (!first1) {
        gui[4].Visible = false;
        first1 = true;
      }
    }
  }
}

function hHotspot2_WalkOn()
{
  if (!light) {
    if (interact(1780, 1220, "Esta linterna está más rota que la cadera de Piqué tras jugar contra CR7. Pero, si algo me han enseñado los desechos sociales de mi barrio es que, aunque sea basura, seguramente me sirva para algo, así que me la llevo.", linterna)){
      cJuli.AddInventory(iLinterna);
      linterna.Transparency = 100;
      light = true;
    }
  }
}

function hHotspot3_WalkOn()
{
  cJuli.ChangeRoom(5, 745, 1290);
}

function hHotspot4_WalkOn()
{
  if (!zoom) {
    if (interact(470, 1230, "¿Qué hacen aquí tantos DNIs? Vaya… Son todos realmente feos.", mesa)){
    }
  }
  else {
    if (interact(470, 1230, "", mesa)){
        if (first2) {
          gui[5].Visible = true;
          first2 = false;
        }
        if (!first2){
          gui[5].Visible = false;
          first2 = true;
        }
      }
  }
}

function hHotspot5_WalkOn()
{
  if (!pila){
    if (interact(162, 984, "Bueno, si estos abrigos están aquí sin dueño… No creo que se pueda considerar robo si encuentro, casualmente, dinero u otro objeto de valor en ellos, ¿no? De todos modos, ¿Qué más da? Si más ilegal que lo que han hecho estos pibes secuestrándome no puede ser.", abrigo)){
      cJuli.Walk(260, 984, eBlock, eWalkableAreas);
      cJuli.AddInventory(iPilas);
      DisplayAtY(20, "Sólo había pilas. Puede que me sirvan en un futuro.");
      pila = true;
    }
  }
}


function hHotspot6_WalkOn()
{
  if (!llaves){
    if (endisc) {
      if (interact(1772, 880, "¡Ojo! Seguramente esta sea la llave que abre la caja fuerte del recibidor.", cExt)){
        cJuli.AddInventory(iLlave);
        llaves = true;
      }
    }
    if (!musica) {
      if (interact(1772, 880, "", cExt)){
        //aAudio.Play();
        musica = true;
      }
    }
  }
}

function hHotspot7_WalkOn()
{
  if (llaves){
    cJuli.ChangeRoom(1, 1500,  1070);
  }
}

function room_Load()
{
  SetTimer(1, 800);
  aDisco.Play();
}

function room_RepExec()
{
  if (IsTimerExpired(1)) {
    SetTimer(5, 200);
    SetTimer(6, 400);
    ShakeScreenBackground(3, 10, 400);
    SetTimer(2, 1000);
  }
  if (IsTimerExpired(2)) {
    SetTimer(8, 400);
    SetTimer(9, 600);
    TintScreen(10, 10, 10);
    SetTimer(3, 600);
  }
  if (IsTimerExpired(3)) {
    TintScreen(0, 0, 0);
    mant = false;
    cJuli.Transparency = 0;
    SetTimer(4, 900);
  }
  if (IsTimerExpired(4)){
    //SetTimer(7, 200);
    //musica = false;
    SetTimer(1, 800);
    //aAudio.Stop();
  }
  if (IsTimerExpired(5)){
    caminar = false;
    coordX = cJuli.DestinationX;
    coordY = cJuli.DestinationY;
  }
  if (IsTimerExpired(6)){
    caminar = true;
  }
  if (IsTimerExpired(7)){
    if (!musica){
      musica = true;
      //aAudio.Play();
    }
  }
  if (IsTimerExpired(8)){
    luz = false;
  }
  if (IsTimerExpired(9)){
    luz = true;
  }
  if ((cJuli.DestinationX != coordX || cJuli.DestinationY != coordY) && !caminar) {
    culpable = false;
  }
  if (!mant && !luz) {
    culpable = false;
  }
   if (cJuli.DestinationX != 300 || cJuli.DestinationY != 1092) {
    mant = false;
    cJuli.Transparency = 0;
  }
}

function hHotspot8_WalkOn()
{
  if (interact(300, 1092, "", manta)){
    mant = true;
    cJuli.Transparency = 100;
  }
}
function room_Leave()
{
aDisco.Stop();
}
